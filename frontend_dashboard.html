<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lars Urlaubs-Deals | Holland mit Hund</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .deal-card:hover { transform: translateY(-5px); transition: all 0.3s ease; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900">

    <!-- Navigation -->
    <nav class="bg-emerald-700 text-white p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold flex items-center">
                <i class="fa-solid fa-paw mr-3"></i> Lars Urlaubs-Deals
            </h1>
            <div class="hidden md:flex space-x-6">
                <a href="#" class="hover:text-emerald-200">Suche</a>
                <a href="#" class="hover:text-emerald-200">Favoriten</a>
                <a href="#" class="hover:text-emerald-200">Wetter</a>
            </div>
        </div>
    </nav>

    <div class="container mx-auto mt-8 px-4 flex flex-col lg:flex-row gap-8">
        
        <!-- Sidebar Suche -->
        <aside class="w-full lg:w-1/4 bg-white p-6 rounded-2xl shadow-sm h-fit">
            <h2 class="text-xl font-semibold mb-6 flex items-center">
                <i class="fa-solid fa-sliders mr-2 text-emerald-600"></i> Suche anpassen
            </h2>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Reiseziele</label>
                    <input type="text" id="input-cities" value="Amsterdam, Zandvoort, Rotterdam" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 bg-gray-50 border focus:ring-emerald-500 focus:border-emerald-500">
                </div>
                
                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Check-In</label>
                        <input type="date" id="input-checkin" value="2026-03-08" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 bg-gray-50 border">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Check-Out</label>
                        <input type="date" id="input-checkout" value="2026-03-15" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 bg-gray-50 border">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Erwachsene</label>
                        <input type="number" id="input-adults" value="2" min="1" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 bg-gray-50 border">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Kinder</label>
                        <input type="number" id="input-children" value="0" min="0" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 bg-gray-50 border">
                    </div>
                </div>

                <div class="flex items-center space-x-2 py-2">
                    <input type="checkbox" id="input-pets" checked class="w-4 h-4 text-emerald-600 border-gray-300 rounded focus:ring-emerald-500">
                    <label for="input-pets" class="text-sm font-medium text-gray-700">Reisen mit Hund</label>
                </div>

                <div class="border-t pt-4">
                    <div class="flex justify-between items-center mb-1">
                        <label class="block text-sm font-medium text-gray-700">Max. Budget (€)</label>
                        <select id="input-budget-type" class="text-xs border-none bg-transparent text-emerald-600 font-bold focus:ring-0">
                            <option value="night">pro Nacht</option>
                            <option value="total">Gesamt</option>
                        </select>
                    </div>
                    <input type="number" id="input-budget" value="250" step="10" class="block w-full border-gray-300 rounded-md shadow-sm p-2 bg-gray-50 border focus:ring-emerald-500 focus:border-emerald-500">
                </div>

                <button id="search-btn" class="w-full bg-emerald-600 text-white py-3 rounded-xl font-semibold hover:bg-emerald-700 transition shadow-md mt-4">
                    Angebote finden
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="w-full lg:w-3/4">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-800">Deine Urlaubs-Deals</h2>
                <p id="status-text" class="text-gray-500">Gefundene Deals für Holland</p>
            </div>

            <!-- Airbnb Section -->
            <section class="mb-12">
                <div class="flex items-center mb-6 border-b pb-2">
                    <i class="fa-brands fa-airbnb text-red-500 text-2xl mr-3"></i>
                    <h2 class="text-2xl font-bold text-gray-700">Airbnb Empfehlungen</h2>
                </div>
                <div id="airbnb-grid" class="grid md:grid-cols-2 gap-6">
                    <div class="col-span-2 text-center py-10 text-gray-400">
                        <i class="fa-solid fa-search fa-2x mb-2"></i>
                        <p>Noch keine Suche gestartet.</p>
                    </div>
                </div>
            </section>

            <!-- Booking Section -->
            <section>
                <div class="flex items-center mb-6 border-b pb-2">
                    <i class="fa-solid fa-hotel text-blue-600 text-2xl mr-3"></i>
                    <h2 class="text-2xl font-bold text-gray-700">Booking.com Favoriten</h2>
                </div>
                <div id="booking-grid" class="grid md:grid-cols-2 gap-6">
                    <div class="col-span-2 text-center py-10 text-gray-400">
                        <i class="fa-solid fa-search fa-2x mb-2"></i>
                        <p>Noch keine Suche gestartet.</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Footer -->
    <footer class="mt-12 bg-gray-800 text-gray-400 py-8">
        <div class="container mx-auto px-4 text-center">
            <p>© 2026 Lars Urlaubs-Deals - Mit ❤️ für Lars & seinen Hund gebaut.</p>
        </div>
    </footer>

    <script>
        const searchBtn = document.getElementById('search-btn');
        const airbnbGrid = document.getElementById('airbnb-grid');
        const bookingGrid = document.getElementById('booking-grid');
        const statusText = document.getElementById('status-text');

        searchBtn.addEventListener('click', async () => {
            const cities = document.getElementById('input-cities').value;
            const checkin = document.getElementById('input-checkin').value;
            const checkout = document.getElementById('input-checkout').value;
            const adults = document.getElementById('input-adults').value;
            const children = document.getElementById('input-children').value;
            const pets = document.getElementById('input-pets').checked ? 1 : 0;
            const budget = document.getElementById('input-budget').value;
            const budgetType = document.getElementById('input-budget-type').value;

            if (!cities || !checkin || !checkout) {
                alert("Bitte fülle alle Felder aus!");
                return;
            }

            // Lade-Anzeige
            searchBtn.disabled = true;
            searchBtn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin mr-2"></i> Suche läuft...';
            
            const loadingHtml = '<div class="col-span-2 text-center py-20"><i class="fa-solid fa-compass fa-spin fa-3x text-emerald-600 mb-4"></i><p class="text-lg font-bold">Suche läuft...</p></div>';
            airbnbGrid.innerHTML = loadingHtml;
            bookingGrid.innerHTML = loadingHtml;

            try {
                const url = `/search?cities=${encodeURIComponent(cities)}&checkin=${checkin}&checkout=${checkout}&adults=${adults}&children=${children}&pets=${pets}&budget=${budget}&budget_type=${budgetType}`;
                const response = await fetch(url);
                const data = await response.json();

                renderDeals(data.top_airbnb_deals, 'airbnb');
                renderDeals(data.top_booking_deals, 'booking');
                
                statusText.innerText = `${data.total_deals_found} Deals verarbeitet für ${data.search_params.nights} Nächte`;
            } catch (error) {
                console.error('Error:', error);
                const errorHtml = '<div class="col-span-2 text-center py-20 text-red-500"><i class="fa-solid fa-circle-exclamation fa-3x mb-4"></i><p>Fehler bei der Suche.</p></div>';
                airbnbGrid.innerHTML = errorHtml;
                bookingGrid.innerHTML = errorHtml;
            } finally {
                searchBtn.disabled = false;
                searchBtn.innerHTML = 'Angebote finden';
            }
        });

        function renderDeals(deals, source) {
            const targetGrid = document.getElementById(source + '-grid');
            if (!deals || deals.length === 0) {
                targetGrid.innerHTML = '<div class="col-span-2 text-center py-10"><p class="text-gray-400 italic">Keine passenden Angebote für diese Quelle gefunden.</p></div>';
                return;
            }

            targetGrid.innerHTML = deals.map(deal => `
                <div class="deal-card bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-100 flex flex-col h-full">
                    <div class="relative h-48 bg-gray-200">
                        <img src="${deal.image_url}" 
                             onerror="this.src='https://via.placeholder.com/800x450.png?text=BILD-LADE-FEHLER'"
                             alt="${deal.name}" 
                             class="object-cover w-full h-full">
                        <div class="absolute top-4 left-4 bg-white/90 backdrop-blur px-3 py-1 rounded-full text-xs font-bold text-emerald-700 flex items-center">
                            <i class="fa-solid fa-star text-yellow-500 mr-1"></i> ${deal.rating}
                        </div>
                        <div class="absolute top-4 right-4 bg-emerald-600 text-white px-3 py-1 rounded-full text-xs font-bold">
                            Score: ${deal.rank_score}
                        </div>
                    </div>
                    <div class="p-5 flex-grow flex flex-col">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="text-md font-bold leading-tight">${deal.name}</h3>
                            ${deal.pet_friendly ? '<span title="Hunde erlaubt" class="text-emerald-600"><i class="fa-solid fa-dog"></i></span>' : ''}
                        </div>
                        <p class="text-gray-500 text-xs mb-4"><i class="fa-solid fa-location-dot mr-1"></i> ${deal.location}</p>
                        
                        <div class="mt-auto border-t pt-4">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-[10px] text-gray-400 uppercase font-bold">Pro Nacht</p>
                                    <p class="text-lg font-bold text-emerald-700">€${deal.price_per_night}</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-[10px] text-gray-400 uppercase font-bold">Gesamtpreis</p>
                                    <p class="text-md font-semibold text-gray-800">€${deal.total_cost_for_trip}</p>
                                </div>
                            </div>
                            <a href="${deal.url}" target="_blank" rel="noreferrer" class="block w-full mt-4 bg-gray-50 border border-gray-200 text-gray-700 py-2 rounded-lg font-bold hover:bg-gray-100 transition text-center text-sm">
                                Zum Angebot <i class="fa-solid fa-external-link ml-1 text-[10px]"></i>
                            </a>
                        </div>
                    </div>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
